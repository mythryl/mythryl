\section{Assemblers}

\subsubsection{Overview}
Assemblers in MLRISC satisfy the api 
\mlrischref{emit/machcode-codebuffer.api}{INSTRUCTION\_EMITTER},
which is defined as:
\begin{SML}
api Machcode_Codebuffer =
sig
   package i : \href{instructions.html}{Machcode}
   package c : \href{cells.html}{CELLS}
   package s : \href{streams.html}{Codebuffer}
   package p : \href{pseudo-ops.html}{Pseudo_Ops}
      sharing I.C = C
      sharing S.P = P

   my make_stream : Annotations.annotations ->
                     ((int -> int) -> I.instruction -> Void,
                      Void,'b,'c,'d,'e) S.stream
end
\end{SML}

The function \sml{make_stream} returns an instruction stream.
By default the output is bound to the stream \sml{asm_stream.asmOutStream} 
defined in the package 
\mlrischref{emit/asmStream.sml}{asm_stream} at creation time.

The package \sml{asm_stream} satisfy the following api.
\begin{SML}
api Asm_Stream = sig
  my asmOutStream : file.Output_Stream REF
  my with_stream : file.Output_Stream -> ('a -> 'b) -> 'a -> 'b
end
\end{SML}
\subsubsection{Redirecting the Output}
It is possible to redirect the output of an instruction stream.
For example, the following statement
\begin{SML}
   asm = make_stream []
\end{SML}
binds the output of \sml{asm} to \sml{asm_stream.asmOutStream}, which
by default is just \sml{file.stdout}.  On the other hand, the
statement
\begin{SML}
   asm = asm_stream.with_stream mystream make_stream []
\end{SML}
binds the output of asm to \sml{mystream}.

\subsubsection{More Details}

Assemblers are automatically generated by the 
\href{mlrisc-md.html}{MDGen} tool.  Some specific generated
assemblers are listed below:
\begin{enumerate}
 \item \mlrischref{sparc/emit/sparcAsm.sml}{Sparc}
 \item \mlrischref{pwrpc32/emit/pwrpc32Asm.sml}{Power PC}
 \item \mlrischref{intel32/emit/intel32Asm.sml}{Intel32}
\end{enumerate}
